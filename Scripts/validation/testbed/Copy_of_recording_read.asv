
%================================================
% Demonstrates the isolation level between
% TX/RX and RX2 on USRP 1 and RX2 on USRP 2
%
%   TX gain = 30dB
%   RX gain = 00dB
%================================================

%% Reading in File

filename = "testbed/iso.00" + ...
    ".dat"; %file name;

r_fid = fopen(filename,'rb'); %openign bin file

fs = 2.5e6; %sampling rate of ettus

interval = 3; %seconds

samples = interval*fs*2; %I and Q

%reading rx form file
r_file = fread(r_fid, samples ,'double');

%changing into complex numbers
rx = r_file(1:2:end) + 1j*r_file(2:2:end);

%converting to row (personal preference)
rx = rx.';

%clsoing opened bin file
fclose(r_fid);

%% Plotting

plot_samples_start = 500e3; %how many samples per plot

plot_samples_stop = 3500e3; %how many samples per plot

plot_length = plot_samples_stop - plot_samples_start;

time = (1:1:plot_length)*1/fs; %time_axis

rxp = rx(plot_samples_start+1:plot_samples_stop); %removes transient

%Time domain
subplot(1,2,1)
plot(time*1e6, real(rxp))

ylabel("Amplitude [V]")
xlabel("Time [\mus]")

frequency = 1:1:plot_length;
frequency = (frequency-length(frequency)/2)*(fs/length(time))/1e6; % MHz

%Frequency Domain
subplot(1,2,2)
plot(frequency, 20*log10(abs(fftshift(fft(rxp)./length(rxp)))));
ylim([-130 -50])
xlim([-1 1])
ylabel("Level [dBm]")
xlabel("Frequency [MHz]")
title("RX2 - USRP 1")


